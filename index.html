<!DOCTYPE html>
<html lang="en">
	<head>
		<link rel="stylesheet" href="src/style.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Map</title>
	</head>
	<body>
		<div id="player">
			<h1>Player Selection</h1>
			<input
				type="range"
				name="playerSelection"
				id="playerSelection"
				min="0"
				max="3"
				value="0"
				oninput="selectPlayer(this.value)"
			/>
			<label for="playerSelection">player selection</label>
		</div>
		<div id="cards">
			<div
				id="card 1"
				class="card"
				onmouseover="card1hover()"
				onmouseleave="card1nohover()"
				onclick="card1click()"
			>
				<p>Lesson 1</p>
			</div>
			<div
				id="card 2"
				class="card"
				onmouseover="card2hover()"
				onmouseleave="card2nohover()"
				onclick="card2click()"
			>
				<p>Lesson 2</p>
			</div>
			<div
				id="card 3"
				class="card"
				onmouseover="card3hover()"
				onmouseleave="card3nohover()"
				onclick="card3click()"
			>
				<p>Lesson 3</p>
			</div>
			<div
				id="card 4"
				class="card"
				onmouseover="card4hover()"
				onmouseleave="card4nohover()"
				onclick="card4click()"
			>
				<p>Lesson 4</p>
			</div>
			<div
				id="card 5"
				class="card"
				onmouseover="card5hover()"
				onmouseleave="card5nohover()"
				onclick="card5click()"
			>
				<p>Lesson 5</p>
			</div>
			<div
				id="card 6"
				class="card"
				onmouseover="card6hover()"
				onmouseleave="card6nohover()"
				onclick="card6click()"
			>
				<p>Lesson 6</p>
			</div>
		</div>
		<div id="lessonsDone">
			<input type="checkbox" name="Lesson 01" id="Lesson01" class="isdone" />
			<label for="Lesson01"></label>
			<input type="checkbox" name="Lesson 02" id="Lesson02" class="isdone" />
			<label for="Lesson02"></label>
			<input type="checkbox" name="Lesson 03" id="Lesson03" class="isdone" />
			<label for="Lesson03"></label>
			<input type="checkbox" name="Lesson 04" id="Lesson04" class="isdone" />
			<label for="Lesson04"></label>
			<input type="checkbox" name="Lesson 05" id="Lesson05" class="isdone" />
			<label for="Lesson05"></label>
			<input type="checkbox" name="Lesson 06" id="Lesson06" class="isdone" />
			<label for="Lesson06"></label>
		</div>

		<p>Lesson Event: <b id="demoEvent">Click a button</b></p>
		<canvas id="firstFloor" width="1920" height="1084"></canvas>

		<!-- RIVE  -->
		<script src="https://unpkg.com/@rive-app/canvas@2.9.1"></script>

		<script>
			// Change marble's color [0, 1 , 2, 3]
			let playerSelector;
			let playerID = 0; // Var to change player in JS

			// Lessons status
			let isLesson1Done;
			let isLesson2Done;
			let isLesson3Done;
			let isLesson4Done;
			let isLesson5Done;
			let isLesson6Done;
			let isLessonsDone = [false, false, false, false, false, false]; // Initial value

			let isLesson1Hover;
			let isLesson2Hover;
			let isLesson3Hover;
			let isLesson4Hover;
			let isLesson5Hover;
			let isLesson6Hover;

			let triggerA;
			let triggerB;
			let triggerC;
			let triggerD;
			let triggerE;
			let triggerf;
			// Create Rive
			const riveInstance = new rive.Rive({
				src: "firstFloor.riv", //get rive file
				canvas: document.getElementById("firstFloor"), //get correct canvas
				autoplay: true,
				stateMachines: "First Floor", // get correct stateMachine
				automaticallyHandleEvents: true, // Automatically handle RiveHTTPEvents
				onLoad: () => {
					// Prevent a blurry canvas by using the device pixel ratio
					riveInstance.resizeDrawingSurfaceToCanvas();

					// Get inputs
					const inputs = riveInstance.stateMachineInputs("First Floor");

					// Change marble's color
					playerSelector = inputs.find((i) => i.name === "playerProfile");
					playerSelector.value = playerID; //initial value

					// Change lesson done status
					isLesson1Done = inputs.find((i) => i.name === "Check Lesson 1");
					isLesson2Done = inputs.find((i) => i.name === "Check Lesson 2");
					isLesson3Done = inputs.find((i) => i.name === "Check Lesson 3");
					isLesson4Done = inputs.find((i) => i.name === "Check Lesson 4");
					isLesson5Done = inputs.find((i) => i.name === "Check Lesson 5");
					isLesson6Done = inputs.find((i) => i.name === "Check Lesson 6");
					isLesson1Done.value = isLessonsDone[0];
					isLesson2Done.value = isLessonsDone[1];
					isLesson3Done.value = isLessonsDone[2];
					isLesson4Done.value = isLessonsDone[3];
					isLesson5Done.value = isLessonsDone[4];
					isLesson6Done.value = isLessonsDone[5];

					// HOVER
					isLesson1Hover = inputs.find((i) => i.name === "Lesson 1 Hover");
					isLesson2Hover = inputs.find((i) => i.name === "Lesson 2 Hover");
					isLesson3Hover = inputs.find((i) => i.name === "Lesson 3 Hover");
					isLesson4Hover = inputs.find((i) => i.name === "Lesson 4 Hover");
					isLesson5Hover = inputs.find((i) => i.name === "Lesson 5 Hover");
					isLesson6Hover = inputs.find((i) => i.name === "Lesson 6 Hover");

					// Triggers
					triggerA = inputs.find((i) => i.name === "Trigger A");
					triggerB = inputs.find((i) => i.name === "Trigger B");
					triggerC = inputs.find((i) => i.name === "Trigger C");
					triggerD = inputs.find((i) => i.name === "Trigger D");
					triggerE = inputs.find((i) => i.name === "Trigger E");
					triggerF = inputs.find((i) => i.name === "Trigger F");
				},
			});

			// Resize the drawing surface if the window resizes
			window.addEventListener(
				"resize",
				() => {
					riveInstance.resizeDrawingSurfaceToCanvas();
				},
				false
			);

			// Get Events
			const demoEvent = document.getElementById("demoEvent");
			const onRiveEventReceived = (riveEvent) => {
				const eventData = riveEvent.data;
				let text =
					Object.keys(eventData.properties)[0] === "lesson"
						? `launch activity #${eventData.properties.lesson} `
						: `${Object.keys(eventData.properties)[0]} ${
								Object.values(eventData.properties)[0]
						  }`;
				demoEvent.innerHTML = text;
			};

			riveInstance.on(rive.EventType.RiveEvent, onRiveEventReceived);

			const eventConsoleLogger = (riveEvent) => {
				const eventData = riveEvent.data;
				console.log(eventData.name);
				console.log(eventData.properties);
				console.log(eventData.properties.lesson);
			};
			riveInstance.on(rive.EventType.RiveEvent, eventConsoleLogger);

			// Player selector from HTML
			const selectPlayer = (n) => {
				playerSelector.value = n;
			};

			// Get Checkboxes
			const checkLesson1 = document.getElementById("Lesson01");
			const checkLesson2 = document.getElementById("Lesson02");
			const checkLesson3 = document.getElementById("Lesson03");
			const checkLesson4 = document.getElementById("Lesson04");
			const checkLesson5 = document.getElementById("Lesson05");
			const checkLesson6 = document.getElementById("Lesson06");

			// Switchers
			checkLesson1.addEventListener("change", (e) => {
				isLesson1Done.value = e.target.checked;
			});
			checkLesson2.addEventListener("change", (e) => {
				isLesson2Done.value = e.target.checked;
			});
			checkLesson3.addEventListener("change", (e) => {
				isLesson3Done.value = e.target.checked;
			});
			checkLesson4.addEventListener("change", (e) => {
				isLesson4Done.value = e.target.checked;
			});
			checkLesson5.addEventListener("change", (e) => {
				isLesson5Done.value = e.target.checked;
			});
			checkLesson6.addEventListener("change", (e) => {
				isLesson6Done.value = e.target.checked;
			});

			const card1hover = () => {
				isLesson1Hover.value = true;
			};
			const card1nohover = () => {
				isLesson1Hover.value = false;
			};
			const card2hover = () => {
				isLesson2Hover.value = true;
			};
			const card2nohover = () => {
				isLesson2Hover.value = false;
			};
			const card3hover = () => {
				isLesson3Hover.value = true;
			};
			const card3nohover = () => {
				isLesson3Hover.value = false;
			};
			const card4hover = () => {
				isLesson4Hover.value = true;
			};
			const card4nohover = () => {
				isLesson4Hover.value = false;
			};
			const card5hover = () => {
				isLesson5Hover.value = true;
			};
			const card5nohover = () => {
				isLesson5Hover.value = false;
			};
			const card6hover = () => {
				isLesson6Hover.value = true;
			};
			const card6nohover = () => {
				isLesson6Hover.value = false;
			};

			const card1click = () => {
				triggerA.fire(); // fire trigger
			};
			const card2click = () => {
				triggerB.fire(); // fire trigger
			};
			const card3click = () => {
				triggerC.fire(); // fire trigger
			};
			const card4click = () => {
				triggerD.fire(); // fire trigger
			};
			const card5click = () => {
				triggerE.fire(); // fire trigger
			};
			const card6click = () => {
				triggerF.fire(); // fire trigger
			};
		</script>
	</body>
</html>
