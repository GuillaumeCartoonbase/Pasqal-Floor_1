<!DOCTYPE html>
<html lang="en">
	<head>
		<link rel="stylesheet" href="src/style.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Map</title>
	</head>
	<body>
		<div id="player">
			<h1>Player Selection</h1>
			<input
				type="range"
				name="playerSelection"
				id="playerSelection"
				min="0"
				max="3"
				value="0"
				oninput="selectPlayer(this.value)"
			/>
			<label for="playerSelection">player selection</label>
		</div>
		<div id="lessonsDone">
			<h1>Lessons done</h1>
			<input type="checkbox" name="Lesson 01" id="Lesson01" />
			<label for="Lesson01">Lesson 01</label>
			<input type="checkbox" name="Lesson 02" id="Lesson02" />
			<label for="Lesson02">Lesson 02</label>
			<input type="checkbox" name="Lesson 03" id="Lesson03" />
			<label for="Lesson03">Lesson 03</label>
			<input type="checkbox" name="Lesson 04" id="Lesson04" />
			<label for="Lesson04">Lesson 04</label>
			<input type="checkbox" name="Lesson 05" id="Lesson05" />
			<label for="Lesson05">Lesson 05</label>
			<input type="checkbox" name="Lesson 06" id="Lesson06" />
			<label for="Lesson06">Lesson 06</label>
		</div>

		<canvas id="firstFloor" width="1920" height="1084"></canvas>
		<p id="testButton">Lesson Event</p>

		<!-- RIVE  -->
		<script src="https://unpkg.com/@rive-app/canvas@2.9.1"></script>

		<script>
			// Change marble's color [0, 1 , 2, 3]
			let playerSelector;
			let playerID = 0; // Var to change player in JS

			// Lessons status
			let isLesson1Done;
			let isLesson2Done;
			let isLesson3Done;
			let isLesson4Done;
			let isLesson5Done;
			let isLesson6Done;
			let isLessonsDone = [false, false, false, false, false, false]; // Initial value

			// Create Rive
			const firstFloor = new rive.Rive({
				src: "firstFloor.riv", //get rive file
				canvas: document.getElementById("firstFloor"), //get correct canvas
				autoplay: true,
				stateMachines: "First Floor", // get correct stateMachine
				automaticallyHandleEvents: true, // Automatically handle RiveHTTPEvents
				onLoad: () => {
					// Prevent a blurry canvas by using the device pixel ratio
					firstFloor.resizeDrawingSurfaceToCanvas();

					// Get inputs
					const inputs = firstFloor.stateMachineInputs("First Floor");

					// Change marble's color
					playerSelector = inputs.find((i) => i.name === "playerSelector");
					playerSelector.value = playerID; //initial value

					// Change lesson done status
					isLesson1Done = inputs.find((i) => i.name === "done 1");
					isLesson2Done = inputs.find((i) => i.name === "done 2");
					isLesson3Done = inputs.find((i) => i.name === "done 3");
					isLesson4Done = inputs.find((i) => i.name === "done 4");
					isLesson5Done = inputs.find((i) => i.name === "done 5");
					isLesson6Done = inputs.find((i) => i.name === "done 6");
					isLesson1Done.value = isLessonsDone[0];
					isLesson2Done.value = isLessonsDone[1];
					isLesson3Done.value = isLessonsDone[2];
					isLesson4Done.value = isLessonsDone[3];
					isLesson5Done.value = isLessonsDone[4];
					isLesson6Done.value = isLessonsDone[5];
				},
			});

			// Resize the drawing surface if the window resizes
			window.addEventListener(
				"resize",
				() => {
					riveInstance.resizeDrawingSurfaceToCanvas();
				},
				false
			);

			// Get Events
			const testButton = document.getElementById("testButton");
			const onRiveEventReceived = (riveEvent) => {
				const eventData = riveEvent.data;
				console.log(eventData.name);
				console.log(eventData.properties);
				testButton.innerHTML = eventData.name;
			};
			firstFloor.on(rive.EventType.RiveEvent, onRiveEventReceived);

			// Player selector from HTML
			const selectPlayer = (n) => {
				playerSelector.value = n;
			};

			// Get Checkboxes
			const checkLesson1 = document.getElementById("Lesson01");
			const checkLesson2 = document.getElementById("Lesson02");
			const checkLesson3 = document.getElementById("Lesson03");
			const checkLesson4 = document.getElementById("Lesson04");
			const checkLesson5 = document.getElementById("Lesson05");
			const checkLesson6 = document.getElementById("Lesson06");

			// Switchers
			checkLesson1.addEventListener("change", (e) => {
				isLesson1Done.value = e.target.checked;
			});
			checkLesson2.addEventListener("change", (e) => {
				isLesson2Done.value = e.target.checked;
			});
			checkLesson3.addEventListener("change", (e) => {
				isLesson3Done.value = e.target.checked;
			});
			checkLesson4.addEventListener("change", (e) => {
				isLesson4Done.value = e.target.checked;
			});
			checkLesson5.addEventListener("change", (e) => {
				isLesson5Done.value = e.target.checked;
			});
			checkLesson6.addEventListener("change", (e) => {
				isLesson6Done.value = e.target.checked;
			});
		</script>
	</body>
</html>
